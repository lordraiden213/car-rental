{% extends "base.html" %}

{% block content %}
<style>
  .vehicle-info-box {
    max-width: 600px;
    margin: 40px auto;
    padding: 30px;
    border-radius: 12px;
    background: linear-gradient(135deg, #e8eff4, #d0d9e1); /* Soft light gradient with a professional touch */
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1); /* Soft shadow around the box */
    text-align: center;
    perspective: 1000px; /* Enables 3D effect */
  }

  .vehicle-info-box:hover {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12); /* Slightly stronger shadow on hover */
  }

  .vehicle-info-box h2 {
    margin-bottom: 20px;
    font-weight: 600;
    color: #2d3748; /* Dark charcoal gray for a sleek, professional heading */
  }

  .vehicle-info-box p {
    margin-bottom: 10px;
    font-size: 16px;
    color: #4a5568; /* Muted gray for text for a clean and polished look */
  }

  .vehicle-info-box img {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 2px solid #e5e7eb; /* Light gray border to maintain the professional look */
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.15); /* Soft, blurry shadow effect for the image */
    animation: hologramRotateZoom 30s infinite linear; /* Slower, smoother hologram with zoom */
    transform-style: preserve-3d;
  }

  @keyframes hologramRotateZoom {
    0% {
      transform: rotateY(0deg) scale(1); /* Starts with normal size */
    }
    50% {
      transform: rotateY(180deg) scale(1.05); /* Zooms in slightly and rotates halfway */
    }
    100% {
      transform: rotateY(360deg) scale(1); /* Completes the rotation and zooms back to normal */
    }
  }

  .back-btn-container {
    margin-top: 20px;
  }

  /* Optional Company Accent Color (Muted Blue or Corporate Tone) */
  .vehicle-info-box h2 {
    color: #4c6d99; /* Muted, professional blue for company accent */
  }

  .vehicle-info-box p {
    color: #6c757d; /* Soft gray for text consistency */
  }
</style>



<div class="container mt-5">

  <!-- Vehicle Info -->
  <div class="vehicle-info-box">
    <h2>{{ vehicle.model }}</h2>
    <p>
      <img src="{{ url_for('static', filename='uploads/vehicles/' + vehicle.image_url) }}" 
           alt="{{ vehicle.model }}">
    </p>
    
    <p><strong>Model:</strong> {{ vehicle.model }}</p>
    <p><strong>Transmission:</strong> {{ vehicle.transmission }}</p>
    <p><strong>Seats:</strong> {{ vehicle.people }} People</p>
    <p><strong>Gas:</strong> {{ vehicle.gas }}</p>
    <p><strong>Price per Day:</strong> {{ vehicle.price_per_day }}</p>
    <p><strong>Status:</strong> {{ vehicle.status }}</p>
    <p><strong>Plate Number:</strong> {{ vehicle.plate_number }}</p>
    <p><strong>Mileage:</strong> {{ vehicle.mileage }}</p>

    <!-- Back to Testimonials Button -->
    <div class="back-btn-container">
      <a class="btn btn-secondary" href="{{ url_for('clients') }}">Back to Testimonials</a>
    </div>
  </div>

  <hr>
  <!-- Testimonials Section -->
  <div class="comment-section">
    <h4>Comments:</h4>
    {% if testimonials %}
      {% for t in testimonials %}
      <div class="card testimonial-card">
        <div class="card-body testimonial-card-body">
          <div class="me-3">
            <img src="{{ url_for('static', filename=t.profile_picture or 'uploads/default.jpg') }} "
                 alt="Profile Picture" class="rounded-circle" width="50" height="50">
          </div>
          <div class="flex-grow-1">
            <h6><strong>User:</strong> {{ t.lastname or 'Anonymous' }}</h6>
            <h6>
              <strong>Rating:</strong>
              {% if t.average_rating %}
                {% for i in range(t.average_rating|round|int) %} ⭐ {% endfor %}
              {% else %}
                No rating
              {% endif %}
            </h6>
            <p>{{ t.comment_text }}</p>
            <small class="text-muted">Posted on {{ t.created_at }}</small>

            {% if session['user_id'] == t.user_id %}
            <div class="dropdown mt-2">
              <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" onclick="toggleOptions({{ t.id }})">
                ⋮
              </button>
              <div id="options{{ t.id }}" class="mt-2" style="display: none;">
                <ul class="list-group">
                  <li class="list-group-item">
                    <form method="POST" action="{{ url_for('edit_testimonial', testimonial_id=t.id) }}" class="edit-form">
                      <textarea name="comment_text" class="form-control" rows="3">{{ t.comment_text }}</textarea>
                      <input type="number" name="average_rating" value="{{ t.average_rating or 0 }}" min="1" max="5" class="form-control my-2">
                      <button type="submit" class="btn btn-warning btn-sm">Update Testimonial</button>
                    </form>
                  </li>
                  <li class="list-group-item">
                    <form id="delete-form-{{ t.id }}" method="POST" action="{{ url_for('delete_testimonial', testimonial_id=t.id) }}">
                      <button type="button" class="btn btn-danger btn-sm" onclick="confirmDelete({{ t.id }})">
                        Delete Testimonial
                      </button>
                    </form>
                  </li>
                </ul>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>No testimonials yet.</p>
    {% endif %}
  </div>

</div>

<!-- JS Libraries -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Flash Messages (via SweetAlert2) -->
<script>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        Swal.fire({
          icon: "{{ 'success' if category == 'success' else 'error' }}",
          title: "{{ message }}",
          showConfirmButton: false,
          timer: 2500
        });
      {% endfor %}
    {% endif %}
  {% endwith %}
</script>

<!-- Custom JS -->
<script>
  function toggleOptions(testimonialId) {
    const options = document.getElementById("options" + testimonialId);
    options.style.display = options.style.display === "none" ? "block" : "none";
  }

  function confirmDelete(testimonialId) {
    Swal.fire({
      title: 'Are you sure?',
      text: "You won’t be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!',
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById('delete-form-' + testimonialId).submit();
      }
    });
  }
</script>
{% endblock %}

